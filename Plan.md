## Организация структуры проекта
1. Разбить программную часть сайта на две подчасти:
    1. Фронтэнд - будет отвечать за ввод даных в формы и визуализацию информации, показ всплывающих окон, пересылку данных форм:
       - реализовать средствами javascript,
       - запросы к локалхосту осуществлять посредством XMLHttpRequest, responseType: 'json',
       - запрос на изменение json-файла делать через 'POST'
       - запрос на чтение json-файла делать через 'GET'
    2. Бэкэнд - будет отвечать за сохранение, изменение и предоставление информации, перенаправление, аутентификацию и авторизацию
        - реализовать средствами php,
        - в ответ на запросы фронтэнда посылать ответ в виде 'echo json_encode(dataResponse)'
    3. Как реализовать взаимодействие между JS и PHP:
        1. [Запрос XMLHttpRequest из JS](https://learn.javascript.ru/xmlhttprequest)
        1. [Получение ответа с сервера из PHP-скрипта](http://qaru.site/questions/194054/get-response-from-php-file-using-ajax)
    3. Данные хранить в виде json-файлов
1. Установить в системе два вида пользователей:
    1. client - обычный, которому недоступна страница admin и доступны страницы:
        1. client
        2. client/hall?session=id_session
        3. client/payment
        4. client/ticket
    2. admin - привилегированный, которому доступна страница admin и действия на ней:
        1. Создание зала
        2. Конфигурация зала
        3. Конфигурация цен
        4. Сетка сеансов
        5. Открытие продажи билетов

### Страница index.php
В настоящий момент она отсутствует и необходимо будет ее создать.
При входе пользователя на сайт страница index.php проверяет авторизацию пользователя через запрос к $_SESSION на наличие ключей 'role' и login:
1. Если пользователь был ранее авторизован с ролью 'admin', то произойдет перенаправление на страницу admin
2. Если пользователь был ранее авторизован с ролью 'user', то он перенаправляется на страницу client.
2. Если пользователь не прошел авторизацию, то ему назначается логин 'guest', роль 'guest', ключ email и он перенаправляется на страницу client.

### Страница аутентификации и авторизации
Вход на страницу осуществляется намеренно по адресу admin/login.
1. Реализовать через XMLHttpRequest запрос к PHP на поиск логина в users.json
    1. Подключить createRequest.js
    2. Подключить Entitiy.js
    2. Подключить User.js
2. В случае положительного ответа пользователя сохранить роль, идентификатор и email пользователя в $_SESSION. Далее происходит перенаправление согласно значению ключа 'role'

### Страница администрирования сеансов admin
При входе на эту страницу на каждую из вкладок происходит асинхронная загрузка данных из файлов halls.json, sessions.json, movies.json
После изменения данных (которое должно осуществляться средствами JS) обновление содержимого для каждой из вкладок "аккордеона" будет происходить асинхронно при обращении xhr-запроса к php-сриптам, указанным в атрибутах форм и кнопок, расположенных во вкладках.

#### Как будет создаваться зал?
Варианты:
1. При клике по кнопке "Создать зал" открывается всплывающее окно формы из файла "hall_add_popup"? после ввода в поле "name" и нажатия кнопки "Добавить зал" название зала передается через XMLHttpRequest в переменную $_POST['hall_name'].  После этого условие проверки на наличие содержимого в $_POST['hall_name'] инициирует сохранение нового зала в в json-файле "Залы", закрытие всплывающего окна и обновление вкладки 'УПРАВЛЕНИЕ ЗАЛАМИ' страницы admin.

#### Как будет происходить конфигурирование зала?
Варианты:
1. Из json-файла "halls.json" загружается коллекция объектов, свойства которых отображаются во втором блоке "КОНФИГУРАЦИЯ ЗАЛОВ". Для добавленного зала появится горизонтальная вкладка содержащая значение свойства "Имя зала". Если залов несколько, то вкладки будут соответствовать их числу. При клике на вкладке с именем зала в окна настроек загружаются параметры зала. Отметка о блокировке места производится с помощью js одним кликом, отметка VIP-мест - двумя кликами. После нажатия кнопки "Сохранить" изменения передаются через XMLHttpRequest в $_POST, сохраняются в halls.json, обновляется содержимое блока "КОНФИГУРАЦИЯ ЗАЛОВ" страницы admin
2. После добавления нового зала происходит обновление страницы и блока "КОНФИГУРАЦИЯ ЗАЛОВ". При этом видимыми будут настройки только того зала, на кнопку которого произведен клик. настройки остальных залов скрыты.

#### Как будет происходить конфигурирование цен?
Варианты:
1. При клике по кнопке с названием зала из коллекции объектов "Залы" в блок "КОНФИГУРАЦИЯ ЦЕН" загружаются значения из свойства цены обекта "Зал" - Зал.Цены.standart и Зал.Цены.vip. После изменения значений в полях при нажатии на кнопку "Сохранить" происходит сохранение или обновлени данных в halls.json если нажата кнопка "Отмена" - сброс содержимого полей до старых значений

#### Как будет работать кнопка "Добавить фильм"?
Варианты:
1. При клике по кнопке открывается всплывающее диалоговое окно "movie_add_popup". При нажатии на кнопку "Добавить фильм" происходит передача содержимого поля name через XMLHttpRequest в перменную $_POST['name']. После этого условие проверки на наличие содержимого в $_POST['name'] иницирует сохранение фильма в json-файл "Фильмы" и обновление блока "СЕТКА СЕАНСОВ" страницы admin.

#### Как будет работать создание/удаление сеанса для фильма?
Варианты:
1. При перетаскивании значка анонса фильма на временную шкалу сеансов в зале открывается всплывающее окно showtime_add_popup и после подтверждения создания сеанса нажатием на кнопку "Добавить сеанс" на временной шкале отображается фильм и время начала сеанса. При нажатии кнопки "Сохранить" данные о сеансах передаются в массив $_POST. Условие проверки переменной запускает сохранение изменения графика сеансов в json-файл "Сеансы" и обновление блока "СЕТКА СЕАНСОВ" страницы admin.


### Страницы для клиентов (client, client/hall, client/payment, client/ticket)
1. Вывод списка фильмов с сеансами по залам на странице client
    1. Сделать через XMLHttpRequest-запрос к PHP-скрипту на получение данных о фильмах из файла movies.json - фильм, производитель, содержание, продолжительность. Вставить результаты запроса в верстку
    2. Для каждого из фильмов сделать по его идентификатору запрос к файлу sessions.json для получения сведений о сеансе - идентификатор зала и время начала сеанса
    3. при фомировании вывода ссылки с указанием времени сеанса предусмотреть data-атрибут data-id, на событие 'click' добавить обработчик, копирующий значение data-id в LocalStorage или в $_SESSION.
        1. [Пример](https://ru.stackoverflow.com/questions/412888/%D0%9E%D0%B1%D1%89%D0%B8%D0%B5-%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B8-php-%D0%B8-javascript)
1. При переходе на страницу client/hall.html js должен через xmlhttprequest послать POST- или GET-запросы к соответствующим json-файлам в следующем порядке:
    1. Получить значение идентификатора сеанса из LocalStorage
    2. Получить по идентификатору сеанса данные о сеансе из sessions.json: Фильм, время, зал.
    3. извлечь из данных о сеансе идентификатор зала
    1. Получить по идентификатору о зале сведения о зале из halls.json: Название, количество рядов, количество мест в ряду, блокированные места, VIP-места, стоимость места, стоимость VIP-места.
    2. С помощью идентификатора сенанса получить сведения о ранее забронированных на него местах из tickets.json
    3. С помощью js установить обработчик клика по элементу, обозначающему незабронированное  незаблокированное место.
    4. При клике по такому месту формируется массив, состоящий из объектов имеющих три сввойства: номер ряда, номер места, тип места - [{row: 1, place: 3, type: standart}].
    5. Установить обработчик клика на кнопку "Забронировать", который будет отправлять xhr-запрос к PHP-скрипту на сохранение этих данных в tickets.json, копировать идентификатор билета в $_SESSION и при удачном сохранении переходить на страницу client/payment

### Страница client/payment
При переходе на эту страницу загружается информация о билете, идентификатор которого находится в $_SESSION из tickets.json. Нажатие на кнопку "Получить код бронирования" приводит к переходу на страницу client/ticket

### Страница client/ticket
При переходе на эту страницу загружается информация о билете, идентификатор которого находится в $_SESSION из tickets.json. С помощью библиотеки phpqrcode генрируется QR-код в виде файла PNG, который выводится сресдтвами js в теле страницы в теге img с классом ticket__info-qr.
Для отправки кода по email через XMLHttpRequest отправляется запрос к PHP-скрипту, производящим отправку инструкцией mail()


## Структура json-объектов, которыми будет оперировать система
1. Пользователь админки users.json
<!-- Список пользователей, которые могут открыть и совершать действия на странице admin  -->
    2. Номер последней записи
    3. Записи о пользователях (структура)
        1. Ключ записи:
            1. имя
            2. e-mail
            2. пароль
2. Залы halls.json
    1. Номер последней записи
    2. Записи о залах (структура):
        1. Ключ записи:
            1. Название зала
            2. Цены билетов для разных типов мест:
                1. обычное место
                2. VIP-место
            2. Количество рядов (R)
            3. Количество кресел в ряду (P)
            4. Массив рядов и мест:
                1. Массив из рядов (ассоциативный массив из R ключей)
                    1. Ряд
                        1. Места (массив из P значений)
                            1. состояние кресла:
                                1. обычное (дефолт);
                                2. VIP (левый клик по дефолт);
                                3. блокировано (отсутствует, левый клик по VIP);
            <!-- 5. Сеансы: -->
3. Фильмы movies.json:
    1. Номер последней записи
    2. Записи
        2. Ключ записи:
            1. Название
            2. Содержание
            3. Длительность (минуты)
            4. Производитель
4. Сеансы sessions.json:
    4. Номер последней записи
    5. Записи о сеансе (структура):
        1. Ключ записи:
            1. Дата сеанса: Дн, nn
            <!-- (День недели, День месяца, если день текущий, то вначале даты слово "Сегодня") -->
            2. Время начала сеанса: чч:мм (24 часовой формат)
            3. Фильм: индекс ключа в json-файле "Фильмы"
            4. Зал: индекс ключа в json-файле "Залы"
            5. Продажа билетов: (открыта | закрыта - true | false)
            <!-- Этот флаг разрешает php-скрипту формировать карту сеансов фильма на  странице client. Устанавливается при нажатии на кнопку с надписью "Открыть продажу билетов"-->
            <!-- 4. Возрастное ограничение -->
5. Билеты tickets.json:
    1. Номер последней записи
    2. Ключ записи:
        1. Сеанс: индекс ключа в json-файле "Сеансы"
        2. Места (массив):
            1. Место
                1. Ряд:
                2. Номер:
        3. QR-код:


## Вопросы возникшие всвязи с несостыковками в ДЗ

1. Как сделать временную шкалу с перетаскиванием фильма?
  1. [How To 1](https://webdesign.tutsplus.com/ru/tutorials/building-a-horizontal-timeline-with-css-and-javascript--cms-28378)
2. QR-код дата последнего обновления - 2010 год - а работать будет?
    1. [Ссылка](http://phpqrcode.sourceforge.net/)
3. Структура файлов и папок из архива Верстка.zip должна остаться неизменной, или это группировка для большего понимания куда какие файлы относятся?
4. параметры action форм указаны без расширений. Какое расширение указать?
1. Какова логика кнопки "Открыть продажу билетов"? Варианты:
    1. При каких условиях можно открывать продажу билетов? Эта кнопка просто делает переход на страницу client/index.html или должны удовлетворяться какие-то требования, активирующие эту кнопку?
    2. Или эта кнопка активирует продажи к вновь добавленному фильму и обновляет страницу выбора сеанса? Свойство открытой/закрытой продажи билетов логично было бы сделать в объекте сеанс?
    3. После каждого добавления фильма в сетку сеансов необходимо сохранять содержимое в json-файл "Сеансы" и заново обновлять сетку? И только по нажатии кнопки "Открыть продажу билетов" на новый сеанс открывается продажа билетов?
2. Почему в диалоге добавления сеанса встречается два раза поле "Название зала" - вероятно имелось в виду название фильма?
3. При каком событии появляются окна showtime_add_popup или showtime_delete_popup - при удалении / добавлении фильма на шкалу времени показов?
2. Как подключить макеты всплывающих окон к верстке страницы? Варианты:
    1. С помощью инструкций include('pagename') до закрытия тега body (но для этого нужно будет содать файл index.php, содержащий верстку):
      1. [Ссылка 1](https://www.php.net/manual/ru/function.include.php)
    2. Сохранить их прямо в файле страницы admin.html
4. На странице 'payment.html' в предпоследнем абзаце написано
> "После оплаты билет будет доступен в этом окне, а также придёт вам на ***почту***".
>
Необходимо реализовать отправку e-mail с сайта и аутентификацию непривелигированых пользователей с авторизацией?
5. Как лучше организовать хранение информации о сеансах и билетах? Варианты:
    1. По вышеизложенной схеме - конфигурация залов отдельно, билеты отдельно, сеансы отдельно, и вместе их сводить на странице client/hall при выборе места для бронирования?
    2. В файле sessions.json хранить в записи о сеансе массив со всеми местами зала но с добавлением свойства "забронировано"?


    ## Heap
    4. Как должно работать добавление нового объекта? Как JS должен взаимодействовать с PHP?
        1. Ссылки:
            1. [Ссылка 1](https://webformyself.com/peredacha-znachenij-peremennyx-iz-javascript-v-php-i-naoborot/)
            2. [Ссылка 2](http://qaru.site/questions/57102/how-to-pass-javascript-variables-to-php)
            3. [Ссылка 3](http://qaru.site/questions/57102/how-to-pass-javascript-variables-to-php)
        2. Варианты:
            1. Данные при клике по кнопкам "Сохранить" должны передаваться в переменные '$_POST' или '$_GET'? А после этого должны происходить обновление страницы, сохранение данных в JSON-файлы и еще раз обновление страницы?
            2. Или данные должны передаваться асинхронно с помощью ajax?
    6. Как будет работать схема разметки кресел в зале? Как ее лучше организовать? Варианты:
        1. Сохранять в записи о сеансе массив всех мест зала с отметками о бронировании, блокировке и VIP-статусе?
        2. Сохранять в записях json-файла "Залы" массив о всех местах зала, сведения о блокированных местах в ключе "lockedPlace" там же, сведения о VIP-местах в ключе "vipPlace" там же, а сведения о забронированных местах в json-файле "Билеты" в ключе "assignPlace"?
    6. Что будет происходить при щелчке по времени сеанса на странице client? Варианты:
        1. ссылка сеанса должна содержать GET-параметр, содержащий идентификатор сеанса, и при щелчке по нему совершается переход на страницу client/hall?id=идентификатор_сеанса
    7. Что будет происходить при переходе на страницу client/hall?id=идентификатор_сеанса? Варианты:
        1. Если до этого обращений по этому id не было, то из json-файла "Залы" согласно индексу ключа "Зал" в записи о сеансе из json-файла "Сеансы" происходит загрузка схемы расположения мест в зале и разметка заблокированных и VIP-мест. После выбора места и нажатия кнопки "Забронировать" происходит сохранение записи о билете с номером ряда и номером места в ряду в json-файл "Билеты".
        2. Если информация о блокированных и vip-местах хранится в ключе "lockedPlace" и "vipPlace", а о бронированных местах хранится в json-файле "Билеты" в ключе "assignPlace" то сначала из файла "Залы" копируется массив мест зала, указанного в
        2. Если это повторное обращение к сеансу, то после загрузки схемы зала должна происходить блокировка забронированных мест помимо тех, что уже заблокированы при разметке зала. После этого кликом  по желаемому месту происходит его бронирование. При клике по "Забронировать" происходит сохранение в json-файл "Билеты" и переход к странице информации о билете "client/payment?id=идентификатор_билета".
    8. После клика по кнопке "Получить код бронирования" происходит переход к странице "client/ticket?id=идентификатор_билета" и генерация QR-кода билета.
