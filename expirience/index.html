<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <p class="display-movie"></p>
    <!-- <script src="/expirience/js/api/createRequest.js"></script>
    <script src="/expirience/js/api/Entity.js"></script>
    <script src="/expirience/js/api/Movie.js"></script> -->
    <script type="text/javascript">

      // const displayMovie = document.querySelector('.display-movie').innerText = '1222';

    // (async () => {
    //   let response = await fetch('http://diplom-net/data/movies.json');
    //   const myJson = await response.json();
    //   console.log(JSON.stringify(myJson));
    // })()

    // (async () => {
    //   let list = '123';
    //
    //   let response = await fetch('http://diplom-net/expirience/reply.php', {
    //   // let response = await fetch('http://diplom-net/expirience/reply.php?list=123', {
    //     method: 'POST',
    //     // headers: {
    //     //   'Content-Type': 'text/plain;charset=utf-8'
    //     // },
    //     body: list
    //     // body: JSON.stringify(user)
    //   });

    const createRequest = async (options = {}) => {
      let {
        url,
        headers,
        data,
        method,
        callback
      } = options;

      let formData = '';

      if (method != 'GET') {
        formData = new FormData();
        for (let key in data) {
          formData.append(key, data[key]);
        }
      }
      else {
        let urlOpts = Object.entries(data).map(function (urlOpt) {return `${urlOpt[0]}=${urlOpt[1]}`}).join('&');
        urlOpts ? url += '?' + urlOpts : url;
      }

      let requestHeaders = {};

      if (headers) {
        for (let header in headers) {
          requestHeaders[header] = headers[header];
        }
      }

      // let film = new FormData();
      // film.append('name', '.+');
      // film.append('entity_method', 'LIST');


      let result = '';
      // console.log(response.headers.get('Content-Type'));
      try {

        let response = await fetch(url, {
          method: method,
          headers: requestHeaders,
          // body: data,
          body: formData,
          credentials: 'include',
        });

        // console.log(result);
        // callback.call(this, null, result);
        if (response.ok && response.status === 200) {
          // for (let [key, value] of response.headers) {
          //   console.log(`${key} = ${value}`);
          // }
          result = await response.json();
          callback.call(this, null, result);
        }
        else {
          console.log(response.status);
        }

        // return result;

      } catch (err) {
        console.log(err);
        const errorXhr = new Error('Ошибка запроса');
        callback.call(this, errorXhr, null);
        // return result;
        // console.log(err);
      }
      // return result
    }

    let film = {
      name: '.+',
      entity_method: 'LIST'
    };

    // const url = 'http://diplom-net/expirience/reply.php';
    const url = 'http://diplom-net/expirience/movie.php';

    let moviesList = createRequest({
      url: url,
      // headers: {},
      // headers: { 'Content-Type': 'text/plain' },
      data: film,
      method: 'POST',
      // method: 'POST',
      callback: (error, response) => {
        if (error === null) {
          console.log(response);
        }
        else {
          console.log(error);
        }
      }
    });

    console.log(moviesList);












    // let response = await fetch(url, {
    //   method: method,
    //   body: formData,
    //   credentials: 'include',
    //   headers: requestHeaders
    //   // body: JSON.stringify(film),
    //   // headers: {
    //   //   'Content-Type': 'application/json'
    //   //   // 'Content-Type': 'text/plain'
    //   // }
    //   // body: list
    // });



    // let headers = {
    //   'Content-Type': 'application/json; charset=utf-8'
    // };
    // let requestHeaders = {};
    // if (headers) {
    //   for (let header in headers) {
    //     requestHeaders[header] = headers[header];
    //   }
    // }
    //
    // console.log(requestHeaders);

    // movieList();

    // async function renderImg() {
    //   let response = await fetch('http://diplom-net/posters/picture_of_the_day_penguin_uv_1.jpg');
    //   let blobImg = await response.blob();
    //   let img = document.createElement('img');
    //   img.style = 'position:fixed;top:10px;left:10px;width:100px';
    //   document.body.append(img);
    //   img.src = URL.createObjectURL(blobImg);
    // }
    //
    // renderImg();


      // (async () => {
      // let url = 'https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits';
      // let response = await fetch(url);
      //
      // let commits = await response.json(); // читаем ответ в формате JSON
      //
      // // console.log(commits);
      // console.log(commits[0]);
      // })()


      // function loadScript(src) {
      //   return new Promise(function(resolve, reject) {
      //     let script = document.createElement('script');
      //     script.src = src;
      //
      //     script.onload = () => resolve(script);
      //     script.onerror = () => reject(new Error(`Ошибка загрузки скрипта ${src}`));
      //
      //     document.head.append(script);
      //   });
      // }
      //
      // let promise = loadScript("https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js");
      //
      // promise.then(
      //   script => alert(`${script.src} загружен!`),
      //   error => alert(`Ошибка: ${error.message}`)
      // );
      //
      // promise.then(script => alert('Ещё один обработчик...'));


      // let promise = new Promise(function(resolve, reject) {
      //   // эта функция выполнится автоматически, при вызове new Promise
      //
      //   // через 1 секунду сигнализировать, что задача выполнена с результатом "done"
      //   setTimeout(() => resolve("Done!"), 1000);
      //   // setTimeout(() => reject(new Error("Whoops!")), 1000);
      // });
      //
      // promise.then( result => console.log(result) );
        // result => result, // выведет "done!" через одну секунду
        // error => alert(error) // не будет запущена
      // );

      // const url = 'http://diplom-net/php/movie.php';
      //
      // let response = await fetch(url, );
      //
      // if (response.ok) { // если HTTP-статус в диапазоне 200-299
      //   // получаем тело ответа (см. про этот метод ниже)
      //   let json = await response.json();
      // } else {
      //   console.log("Ошибка HTTP: " + response.status);
      // }

    </script>
  </body>
</html>
